<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>ELECCIONES PROVINCIALES LEGISLATIVAS 2025 PBA</title>
  <style>
    body { font-family: sans-serif; padding: 20px; max-width: 800px; margin: auto; }
    .party { margin: 10px 0; display: flex; align-items: center; }
    .label { display: inline-block; width: 150px; display: flex; align-items: center; }
    .label img { width: 60px; height: 60px; margin-right: 8px; object-fit: cover; border-radius: 0; }
    .value { width: 50px; display: inline-block; text-align: right; }
    .seat { font-weight: bold; margin-left: 10px; }
    input[type=range] {
      width: 300px; height: 10px; border-radius: 5px; outline: none; background: #ccc;
      appearance: none;
    }
    input[type=range]::-webkit-slider-thumb {
      appearance: none; width: 16px; height: 16px; border-radius: 50%; background: #000; cursor: pointer;
    }
    section {
      border: 1px solid #ccc; padding: 10px; margin: 10px 0; border-radius: 8px; width: 100%; box-sizing: border-box;
    }
    h2 {
      background-color: #f0f0f0; padding: 10px; border-radius: 6px; font-size: 1.1em; display: flex; justify-content: space-between; align-items: center;
    }
    .grid { display: block; }
    input.LLA { background: violet; }
    input.FP { background: lightblue; }
    input.SBA { background: orange; }
    input.HECHOS { background: pink; }
    input.FIT { background: red; }
    input.OTROS { background: gray; }

    /* Nuevo estilo para el cuadro final */
    #resumenFinal {
      margin-top: 40px;
      padding: 20px;
      border: 2px solid #333;
      border-radius: 8px;
      background-color: #f9f9f9;
    }
    .resumen-linea { display: flex; align-items: center; margin: 8px 0; }
    .resumen-linea img { width: 60px; height: 60px; margin-right: 10px; object-fit: cover; }
  </style>
</head>
<body>
  <h1>ELECCIONES PROVINCIALES LEGISLATIVAS 2025 PBA</h1>

  <div class="grid" id="simuladores"></div>

  <div id="resumenFinal">
    <h2>Resultado Final Provincial</h2>
    <div id="tablaResumen"></div>
  </div>

  <script>
    const secciones = [
      { nombre: "1ra Sección - Senado", bancas: 8, padron: 4732831 },
      { nombre: "4ta Sección - Senado", bancas: 7, padron: 540354 },
      { nombre: "5ta Sección - Senado", bancas: 5, padron: 1290948 },
      { nombre: "7ma Sección - Senado", bancas: 3, padron: 281130 },
      { 
        nombre: "2da Sección - Diputados", 
        bancas: 11, 
        padron: 649465,
        fuerzas: ["LLA", "FP", "HECHOS", "FIT", "OTROS"] 
      },
      { nombre: "3ra Sección - Diputados", bancas: 18, padron: 4637863 },
      { nombre: "6ta Sección - Diputados", bancas: 11, padron: 652077 },
      { nombre: "8va Sección - Diputados", bancas: 6, padron: 576691 }
    ];

    const defaultFuerzas = ["LLA", "FP", "SBA", "FIT", "OTROS"];
    const colores = { "LLA": "violet", "FP": "lightblue", "SBA": "orange", "HECHOS": "pink", "FIT": "red", "OTROS": "gray" };
    const logos = {
      "LLA": "img/lla.png",
      "FP": "img/fp.png",
      "SBA": "img/somosba.png",
      "HECHOS": "img/hechos_nuevo.png",
      "FIT": "img/fit.png"
    };

    function crearSimulador(seccion, index) {
      const container = document.createElement("section");
      const fuerzas = seccion.fuerzas || defaultFuerzas;
      container.innerHTML = `<h2>${seccion.nombre} <span>${seccion.bancas} bancas</span></h2>
        <p>Total porcentajes: <span id="total_${index}">0%</span></p>
        <div id="sliders_${index}"></div>`;
      document.getElementById("simuladores").appendChild(container);

      fuerzas.forEach(f => {
        const div = document.createElement("div");
        div.className = "party";
        const logo = logos[f] ? `<img src="${logos[f]}" alt="${f}">` : `<div style="width:60px;height:60px;"></div>`;
        div.innerHTML = `
          <span class="label">${logo}${f}</span>
          <input type="range" min="0" max="100" value="0" class="${f}" style="background:${colores[f] || '#ccc'}" id="${f}_slider_${index}" oninput="updateAll(${index})">
          <span class="value" id="${f}_val_${index}">0%</span>
          <span class="seat" id="${f}_seats_${index}">0 bancas</span>
        `;
        document.getElementById(`sliders_${index}`).appendChild(div);
      });
    }

    function updateAll(index) {
      const seccion = secciones[index];
      const fuerzas = seccion.fuerzas || defaultFuerzas;
      const totalSeats = seccion.bancas;
      const cutoff = 100 / totalSeats;

      let total = 0;
      const data = [];

      fuerzas.forEach(f => {
        const val = parseFloat(document.getElementById(`${f}_slider_${index}`).value);
        total += val;
        document.getElementById(`${f}_val_${index}`).textContent = val.toFixed(1) + '%';
        data.push({ name: f, percent: val, votes: val >= cutoff ? val : 0 });
      });

      document.getElementById(`total_${index}`).textContent = total.toFixed(1) + '%';

      if (total !== 100) {
        fuerzas.forEach(f => {
          document.getElementById(`${f}_seats_${index}`).textContent = '—';
        });
        return;
      }

      let totalVotes = data.reduce((acc, p) => acc + p.votes, 0);
      const quota = totalVotes / totalSeats;

      const assigned = {};
      const remainders = [];
      fuerzas.forEach(f => assigned[f] = 0);

      data.forEach(p => {
        if (p.votes > 0) {
          const raw = p.votes / quota;
          const whole = Math.floor(raw);
          const rem = raw - whole;
          assigned[p.name] = whole;
          remainders.push({ name: p.name, remainder: rem });
        }
      });

      let used = Object.values(assigned).reduce((a, b) => a + b, 0);
      const remaining = totalSeats - used;
      remainders.sort((a, b) => b.remainder - a.remainder);
      for (let i = 0; i < remaining; i++) {
        assigned[remainders[i].name]++;
      }

      fuerzas.forEach(f => {
        document.getElementById(`${f}_seats_${index}`).textContent = `${assigned[f]} bancas`;
      });

      calcularTotalesGlobales();
    }

    function calcularTotalesGlobales() {
      const totalVotos = {};
      const totalBancas = {};
      secciones.forEach((sec, idx) => {
        const fuerzas = sec.fuerzas || defaultFuerzas;
        fuerzas.forEach(f => {
          const val = parseFloat(document.getElementById(`${f}_slider_${idx}`).value);
          const votos = sec.padron * val / 100;
          const bancas = parseInt(document.getElementById(`${f}_seats_${idx}`).textContent) || 0;
          totalVotos[f] = (totalVotos[f] || 0) + votos;
          totalBancas[f] = (totalBancas[f] || 0) + bancas;
        });
      });
      renderResumen(totalVotos, totalBancas);
    }

    function renderResumen(votosTotales, bancasTotales) {
      const totalPadron = secciones.reduce((acc, s) => acc + s.padron, 0);
      const contenedor = document.getElementById("tablaResumen");

      const resultados = Object.keys(votosTotales).map(f => ({
        fuerza: f,
        votos: votosTotales[f],
        porcentaje: (votosTotales[f] * 100 / totalPadron),
        bancas: bancasTotales[f] || 0
      }));

      resultados.sort((a, b) => b.votos - a.votos);

      contenedor.innerHTML = "";
      resultados.forEach(r => {
        const votosFormateados = Math.round(r.votos).toLocaleString("es-AR");
        const logo = logos[r.fuerza]
          ? `<img src="${logos[r.fuerza]}" alt="${r.fuerza}">`
          : `<div style="width:60px; height:60px;"></div>`;

        contenedor.innerHTML += `
          <div class="resumen-linea">
            ${logo}
            <strong>${r.fuerza}</strong>:
            ${r.porcentaje.toFixed(2)}% (${votosFormateados} votos)
            – ${r.bancas} legisladores
          </div>
        `;
      });
    }

    secciones.forEach((sec, idx) => crearSimulador(sec, idx));
  </script>
</body>
</html>
