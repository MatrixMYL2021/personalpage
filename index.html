<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>ELECCIONES PROVINCIALES LEGISLATIVAS 2025 PBA</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
      max-width: 800px;
      margin: auto;
    }

    /* ========== SECCIÓN ========== */
    section {
      border: 1px solid #ccc;
      border-radius: 8px;
      margin: 10px 0;
      overflow: hidden;
    }
    section h2 {
      margin: 0;
      padding: 8px 12px;
      background: #f0f0f0;
      border-bottom: 1px solid #ccc;
      font-size: 1.1em;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    #simuladores > section > p {
      margin: 10px 12px;
    }

    .party {
      display: grid;
      /* logo 80px / nombre 200px / slider 1fr / % 60px / bancas 100px */
      grid-template-columns: 80px 200px 1fr 60px 100px;
      column-gap: 12px;
      align-items: center;
      margin: 8px 12px;
    }

    .logo-cell {
      display: flex;
      justify-content: center;
    }
    .logo-cell img {
      width: 60px;
      height: 60px;
      object-fit: cover;
    }

    .name-cell {
      display: flex;
      align-items: center;
    }
    .name-cell strong {
      white-space: nowrap;
    }

    input[type=range] {
      width: 100%;
      height: 10px;
      border-radius: 5px;
      outline: none;
      background: #ccc;
      appearance: none;
    }
    input[type=range]::-webkit-slider-thumb {
      appearance: none;
      width: 16px;
      height: 16px;
      border-radius: 50%;
      background: #000;
      cursor: pointer;
    }

    .value {
      text-align: right;
    }
    .seat {
      font-weight: bold;
    }

    input.LLA    { background: violet; }
    input.FP     { background: lightblue; }
    input.SBA    { background: orange; }
    input.HECHOS { background: pink; }
    input.FIT    { background: red; }
    input.OTROS  { background: gray; }

    /* ========== RESUMEN FINAL ========== */
    #resumenFinal {
      margin-top: 40px;
      padding: 20px;
      border: 2px solid #333;
      border-radius: 8px;
      background-color: #f9f9f9;
    }
    #tablaResumen {
      display: grid;
      row-gap: 12px;
      padding: 12px;
    }
    .resumen-linea {
      display: grid;
      /* logo 80px / info 1fr / diferencial 100px */
      grid-template-columns: 80px 1fr 100px;
      column-gap: 12px;
      align-items: center;
    }
    .resumen-linea .logo-cell {
      display: flex;
      justify-content: center;
      align-items: center;
    }
    .resumen-linea .logo-cell img {
      width: 60px;
      height: 60px;
      object-fit: cover;
    }
    .resumen-linea .info-cell {
      font-size: 0.95em;
    }
    .resumen-linea .diff-cell {
      text-align: center;
      font-weight: bold;
    }
    /* Opcional: dar estilo distinto a la cabecera */
    .resumen-linea.header .diff-cell {
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <h1>ELECCIONES PROVINCIALES LEGISLATIVAS 2025 PBA</h1>

  <div id="simuladores"></div>

  <div id="resumenFinal">
    <h2>Resultado Final Provincial</h2>
    <div id="tablaResumen"></div>
  </div>

  <script>
    const secciones = [
  {
    nombre: "1ra Sección - Senado",
    bancas: 8,
    padron: 4732831,
    displayNames: {
      LLA:   "D. Valenzuela",
      FP:    "G. Katopodis",
      SBA:   "J. Zamora",
      FIT:   "R. Del Plá"
    }
  },
  {
    nombre: "4ta Sección - Senado",
    bancas: 7,
    padron: 540354,
    displayNames: {
      LLA:   "G. Cabezas",
      FP:    "D. Videla",
      SBA:   "P. Petrecca",
      FIT:   "L. Roggero"
    }
  },
  {
    nombre: "5ta Sección - Senado",
    bancas: 5,
    padron: 1290948,
    displayNames: {
      LLA:   "G. Montenegro",
      FP:    "F. Raverta",
      SBA:   "M. Balsamello",
      FIT:   "A. Martinez"
    }
  },
  {
    nombre: "7ma Sección - Senado",
    bancas: 3,
    padron: 281130,
    displayNames: {
      LLA:   "A. Speroni",
      FP:    "M. Laurini",
      SBA:   "F. Martini",
      FIT:   "E. Marin"
    }
  },
  {
    nombre: "2da Sección - Diputados",
    bancas: 11,
    padron: 649465,
    fuerzas: ["LLA", "FP", "HECHOS", "FIT", "OTROS"],
    displayNames: {
      LLA:    "N. Blanco",
      FP:     "D. Nanni",
      HECHOS: "M. Passaglia",
      FIT:    "J. Nuñez"
    }
  },
  {
    nombre: "3ra Sección - Diputados",
    bancas: 18,
    padron: 4637863,
    displayNames: {
      LLA:   "M. Bondarenko",
      FP:    "V. Magario",
      SBA:   "P. Domenichini",
      FIT:   "N. Del Caño"
    }
  },
  {
    nombre: "6ta Sección - Diputados",
    bancas: 11,
    padron: 652077,
    displayNames: {
      LLA:   "O. Liberman",
      FP:    "A. Diachiara",
      SBA:   "A. De Leo",
      FIT:   "H. Zaris"
    }
  },
  {
    nombre: "8va Sección - Diputados",
    bancas: 6,
    padron: 576691,
    displayNames: {
      LLA:   "J. Osaba",
      FP:    "A. Archanco",
      SBA:   "P. Nicoletti",
      FIT:   "L. Cano"
    }
  }
];


    const defaultFuerzas = ["LLA", "FP", "SBA", "FIT", "OTROS"];
    const colores = {
      "LLA": "violet",
      "FP": "lightblue",
      "SBA": "orange",
      "HECHOS": "pink",
      "FIT": "red",
      "OTROS": "gray"
    };
    const logos = {
      "LLA": "img/lla.png",
      "FP": "img/fp.png",
      "SBA": "img/somosba.png",
      "HECHOS": "img/hechos_nuevo.png",
      "FIT": "img/fit.png",
      "OTROS": ""
    };

    // Bancas a renovar por fuerza:
    const renewals = {
      FP: 29,
      SBA: 19,
      LLA: 18,
      FIT: 2,
      OTROS: 1,
      HECHOS: 0
    };

    function crearSimulador(seccion, index) {
      const container = document.createElement("section");
      const fuerzas = seccion.fuerzas || defaultFuerzas;
      container.innerHTML = `
        <h2>${seccion.nombre} <span>${seccion.bancas} bancas</span></h2>
        <p>Total porcentajes: <span id="total_${index}">0%</span></p>
        <div id="sliders_${index}"></div>
      `;
      document.getElementById("simuladores").appendChild(container);

      fuerzas.forEach(f => {
        const div = document.createElement("div");
        div.className = "party";

        const logoHTML = logos[f]
          ? `<img src="${logos[f]}" alt="${f}">`
          : `<div style="width:60px; height:60px;"></div>`;

        const labelText = (seccion.displayNames && seccion.displayNames[f]) || f;

        div.innerHTML = `
          <div class="logo-cell">${logoHTML}</div>
          <div class="name-cell"><strong>${labelText}</strong></div>
          <input type="range" min="0" max="100" value="0"
                 class="${f}" id="${f}_slider_${index}"
                 oninput="updateAll(${index})">
          <span class="value" id="${f}_val_${index}">0%</span>
          <span class="seat" id="${f}_seats_${index}">0 bancas</span>
        `;
        document.getElementById(`sliders_${index}`).appendChild(div);
      });
    }

    function updateAll(index) {
      const seccion = secciones[index];
      const fuerzas = seccion.fuerzas || defaultFuerzas;
      const totalSeats = seccion.bancas;
      const cutoff = 100 / totalSeats;

      let total = 0;
      const data = [];

      fuerzas.forEach(f => {
        const val = parseFloat(document.getElementById(`${f}_slider_${index}`).value);
        total += val;
        document.getElementById(`${f}_val_${index}`).textContent = val.toFixed(1) + '%';
        data.push({ name: f, percent: val, votes: val >= cutoff ? val : 0 });
      });

      document.getElementById(`total_${index}`).textContent = total.toFixed(1) + '%';

      if (total !== 100) {
        fuerzas.forEach(f => {
          document.getElementById(`${f}_seats_${index}`).textContent = '—';
        });
        return;
      }

      const totalVotes = data.reduce((acc, p) => acc + p.votes, 0);
      const quota = totalVotes / totalSeats;

      const assigned = {};
      const remainders = [];
      fuerzas.forEach(f => assigned[f] = 0);

      data.forEach(p => {
        if (p.votes > 0) {
          const raw = p.votes / quota;
          const whole = Math.floor(raw);
          const rem = raw - whole;
          assigned[p.name] = whole;
          remainders.push({ name: p.name, remainder: rem });
        }
      });

      let used = Object.values(assigned).reduce((a, b) => a + b, 0);
      const remaining = totalSeats - used;
      remainders
        .sort((a, b) => b.remainder - a.remainder)
        .slice(0, remaining)
        .forEach(r => assigned[r.name]++);

      fuerzas.forEach(f => {
        document.getElementById(`${f}_seats_${index}`).textContent = `${assigned[f]} bancas`;
      });

      calcularTotalesGlobales();
    }

    function calcularTotalesGlobales() {
      const totalVotos = {};
      const totalBancas = {};
      secciones.forEach((sec, idx) => {
        const fuerzas = sec.fuerzas || defaultFuerzas;
        fuerzas.forEach(f => {
          const val = parseFloat(document.getElementById(`${f}_slider_${idx}`).value);
          const votos = sec.padron * val / 100;
          const bancas = parseInt(document.getElementById(`${f}_seats_${idx}`).textContent) || 0;
          totalVotos[f] = (totalVotos[f] || 0) + votos;
          totalBancas[f] = (totalBancas[f] || 0) + bancas;
        });
      });
      renderResumen(totalVotos, totalBancas);
    }

    function renderResumen(votosTotales, bancasTotales) {
      const totalPadron = secciones.reduce((acc, s) => acc + s.padron, 0);
      const contenedor = document.getElementById("tablaResumen");

      const resultados = Object.keys(votosTotales).map(f => ({
        fuerza: f,
        votos: votosTotales[f],
        porcentaje: votosTotales[f] * 100 / totalPadron,
        bancas: bancasTotales[f] || 0
      }))
      .sort((a, b) => b.votos - a.votos);

      // Cabecera con título de columna "Diferencial"
      contenedor.innerHTML = `
        <div class="resumen-linea header">
          <div class="logo-cell"></div>
          <div class="info-cell"></div>
          <div class="diff-cell"><strong>Diferencial</strong></div>
        </div>
      `;

      // Cada fuerza
      resultados.forEach(r => {
        const votosFormateados = Math.round(r.votos).toLocaleString("es-AR");
        const logoHTML = logos[r.fuerza]
          ? `<img src="${logos[r.fuerza]}" alt="${r.fuerza}">`
          : `<div style="width:60px; height:60px;"></div>`;

        // Calcula diferencial
        const renov = renewals[r.fuerza] || 0;
        const diff = r.bancas - renov;
        let diffText;
        if (diff > 0)      diffText = `+${diff} ↑`;
        else if (diff < 0) diffText = `${diff} ↓`;
        else               diffText = `0 ↔`;

        contenedor.innerHTML += `
          <div class="resumen-linea">
            <div class="logo-cell">${logoHTML}</div>
            <div class="info-cell">
              <strong>${r.fuerza}</strong>:
              ${r.porcentaje.toFixed(2)}% (${votosFormateados} votos)
              – ${r.bancas} legisladores
            </div>
            <div class="diff-cell">${diffText}</div>
          </div>
        `;
      });
    }

    secciones.forEach((sec, idx) => crearSimulador(sec, idx));
  </script>
</body>
</html>
